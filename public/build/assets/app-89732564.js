var b=Object.defineProperty;var E=(e,t,o)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var u=(e,t,o)=>(E(e,typeof t!="symbol"?t+"":t,o),o);const y={render(){return console.log("render"),`
        <div>
            <h1>hello world</h1>
            [sokeio::demo2 /]
        </div>
        `}},O={state:{tesst:"<h1>hello world</h1>test"},render(){return`
        <div>
            <h1>hello world</h1>
            <div so-text="tesst">dfdfdfdf</div>
            <div so-html="tesst">dfdfdfdf</div>
            <input so-model="tesst" />
            <select so-model="tesst">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            </select>
            <textarea so-model="tesst" ></textarea>
            <button so-on:click="tesst=new Date().getTime();">click</button>
            <button so-on:click="this.tesst=new Date().getTime();">click2</button>
        </div>
        `}};function k({component:e,el:t,name:o,method:s,value:n}){n&&(e.watch(n,()=>{t.innerHTML=e[n]}),t.innerHTML=e[n])}function C({component:e,el:t,name:o,method:s,value:n}){n&&(e.watch(n,()=>{t.value=e[n]}),t.value=e[n],t.addEventListener("input",i=>{e[n]=i.target.value}))}function P(e){const t=/\[([\w-:]+)((?:\s+\w+\s*=\s*"[^"]*")*)(\](.*?)\[\/\1\]|\s*\/\])/gs;return[...e.matchAll(t)].map(o=>{const[s,n,i,,r]=o;return{component:s,tag:n,attrs:i,content:r}})}const T="############$$$$$$$$############";function j(...e){console.log(...e)}function L(e){const t=(r,d)=>(Object.getOwnPropertyDescriptor(r,d)||{}).get,o=(r,d)=>typeof r[d]=="function",s=r=>r&&r!==Object.prototype&&Object.getOwnPropertyNames(r).filter(d=>t(r,d)||o(r,d)).concat(s(Object.getPrototypeOf(r))||[]),n=r=>Array.from(new Set(s(r)));return(r=>n(r).filter(d=>d!=="constructor"&&!~d.indexOf("__")))(e)}function F(e){let t={};return Reflect.ownKeys(e).forEach(o=>{Object.defineProperty(t,o,{get(){return e[o]},set(s){e[o]=s},enumerable:!0,configurable:!0})}),t}function R(e,t,o){return new Function("$event","$obj",`with($obj) {  ${e}}`).apply(o,[t,F(o)])}function D(e,t,o){if(!t||!e)return;let s=t.split(".");if(s.length===1)return e[t]=o,e[t];let n=s.shift(),i=s.join(".");n&&(e[n]===void 0&&(e[n]={}),this.dataSet(e[n],i,o))}function M(e,t){return t===""||!t?e:t.split(".").reduce((o,s)=>{if(o!==void 0)return o[s]},e)}function H(e){const t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}const c={getComponentsFromText:P,LOG:j,tagSplit:T,runFunction:R,getMethods:L,dataSet:D,dataGet:M,convertHtmlToElement:H};function S({component:e,el:t,name:o,method:s,value:n}){n&&t.addEventListener(s,i=>{c.runFunction(n,i,e)})}function V({component:e,el:t,name:o,method:s,value:n}){n&&(e.watch(n,()=>{t.innerText=e[n]}),t.innerText=e[n])}const f={html:k,model:C,text:V,on:S},a="so-";function x(e){setTimeout(()=>{e.$el.querySelectorAll("*").forEach(t=>{[...t.attributes].forEach(o=>{if(o.name.startsWith(a)){let s=o.name.split(":"),n=s[0].replace(a,""),i=s[1],r="";i&&(i=i.split("."),i.length>1&&(r=i[1],i=i[0])),f[n]?f[n]({component:e,el:t,name:n,method:i,method2:r,value:o.value}):console.error("feature not found: "+n)}})})})}class h{constructor(t=void 0){u(this,"listeners",{});u(this,"removeListeners",[]);u(this,"data",{});this.data=t??{}}getValue(t){return this.data[t]}setValue(t,o){const s=this.data[t];setTimeout(()=>{this.changeProperty(t,o,s)},1),this.data[t]=o}watch(t,o){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(o)}changeProperty(t,o,s){this.listeners[t]&&this.listeners[t].forEach(n=>n(o,s))}cleanup(){this.removeListeners.forEach(t=>t()),this.removeListeners=[],this.listeners={}}check(t){return this.data[t]!==void 0}getKeys(){return Object.keys(this.data)}}let B=new Date().getTime(),l={},K=(e,t,o)=>!e.startsWith("_")&&o.indexOf(e)===t;function A(e,t){l[e]=t}function I(e,t,o=null){return l[e]?m(l[e],t,o):(console.error("Component not found: "+e),null)}function G(e){let t=e.$el.innerHTML,s=c.getComponentsFromText(t).map(n=>(t=t.split(n.component).join(c.tagSplit),I(n.tag,n.attrs,e)));if(s.length){let n="";t.split(c.tagSplit).forEach((i,r)=>{n+=i,s[r]&&(n+='<span id="sokeio-component-'+s[r].getId()+'">'+s[r].getId()+"</span>")}),t=n,e.$children=s}return e.$el.innerHTML=t,e}function m(e,t,o=null){let s={...e,$parent:o,$children:[],$id:0,$el:null,$manager:null};return Object.defineProperty(s,"getId",{value:function(){return this.$id||(this.$id=++B),this.$id}}),Object.defineProperty(s,"__data__",{value:new h(e.state??{})}),Object.defineProperty(s,"__props__",{value:new h(t)}),Object.defineProperty(s,"watch",{value:function(n,i){this.__data__.check(n)&&this.__data__.watch(n,i),this.__props__.check(n)&&this.__props__.watch(n,i)}}),Object.defineProperty(s,"cleanup",{value:function(n,i){this.__data__.cleanup(n,i)}}),Object.defineProperty(s,"doBoot",{value:function(){let n=this.render?this.render():"<div></div>";n=n.trim(),this.$el=c.convertHtmlToElement(n),G(this),x(this),this.$children&&this.$children.forEach(i=>{i.doBoot(),i.boot&&i.boot()})}}),Object.defineProperty(s,"doRender",{value:function(){this.$children&&this.$children.forEach(n=>{let i=this.$el.querySelector("#sokeio-component-"+n.getId());i.parentNode.insertBefore(n.$el,i),i.remove(),n.doRender()})}}),Object.defineProperty(s,"doReady",{value:function(){this.$children&&this.$children.forEach(n=>{n.doReady()})}}),Object.defineProperty(s,"doDestroy",{value:function(){this.$children&&this.$children.forEach(n=>{n.doDestroy(),n.destroy&&n.destroy()})}}),new Proxy(s,{ownKeys:n=>n.__data__.getKeys().concat(n.__props__.getKeys()).concat(c.getMethods(n)).concat(Object.keys(n)).filter(K),set:(n,i,r)=>n.__data__.check(i)?(n.__data__.setValue(i,r),!0):n.__props__.check(i)?(n.__props__.setValue(i,r),!0):n[i]!==void 0?(n[i]=r,!0):!1,get:(n,i)=>n.__data__.check(i)?n.__data__.getValue(i):n.__props__.check(i)?n.__props__.getValue(i):(n[i]!==void 0,n[i])})}let p=!1,_=!1;function N(e){document.addEventListener("sokeio::register",e)}function W(e){document.addEventListener("sokeio::boot",e)}function z(e){p?e():document.addEventListener("sokeio::ready",e)}function U(e){document.addEventListener("sokeio::destroy",e)}function g(){document.dispatchEvent(new CustomEvent("sokeio::register",{detail:{registerComponent:A}}))}function v(e){e&&e.doBoot(),document.dispatchEvent(new CustomEvent("sokeio::boot"))}function w(e){e&&e.doRender(),document.dispatchEvent(new CustomEvent("sokeio::render"))}function $(e){e&&e.doReady(),document.dispatchEvent(new CustomEvent("sokeio::ready")),p=!0}function J(e){e&&e.doDestroy(),document.dispatchEvent(new CustomEvent("sokeio::destroy"))}function Q(e={},t=null){_||(g(),_=!0),document.dispatchEvent(new CustomEvent("sokeio::run"));let o=new m(e,{});return v(o),w(o),$(o),t||(t=document.body),typeof t=="string"&&(t=document.querySelector(t)),t&&t.appendChild(o.$el),o}const X=Object.freeze(Object.defineProperty({__proto__:null,boot:v,destroy:J,onBoot:W,onDestroy:U,onReady:z,onRegister:N,ready:$,register:g,render:w,run:Q},Symbol.toStringTag,{value:"Module"}));document.addEventListener("sokeio::register",({detail:{registerComponent:e}})=>{e("demo::test",y),e("sokeio::demo2",O)});window.sokeio={Application:X};
