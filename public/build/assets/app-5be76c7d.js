var m=Object.defineProperty;var f=(o,t,e)=>t in o?m(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var l=(o,t,e)=>(f(o,typeof t!="symbol"?t+"":t,e),e);function v(o){const t=/\[([\w-:]+)((?:\s+\w+\s*=\s*"[^"]*")*)(\](.*?)\[\/\1\]|\s*\/\])/gs;return[...o.matchAll(t)].map(e=>{const[n,s,r,,i]=e;return{component:n,tag:s,attrs:r,content:i}})}const b="############$$$$$$$$############";function g(...o){console.log(...o)}function w(o){const t=(i,c)=>(Object.getOwnPropertyDescriptor(i,c)||{}).get,e=(i,c)=>typeof i[c]=="function",n=i=>i&&i!==Object.prototype&&Object.getOwnPropertyNames(i).filter(c=>t(i,c)||e(i,c)).concat(n(Object.getPrototypeOf(i))||[]),s=i=>Array.from(new Set(n(i)));return(i=>s(i).filter(c=>c!=="constructor"&&!~c.indexOf("__")))(o)}function C(o){let t={};return Reflect.ownKeys(o).forEach(e=>{console.log(e),Object.defineProperty(t,e,{get(){return o[e]},set(n){o[e]=n},enumerable:!0,configurable:!0})}),t}function y(o,t,e){return new Function("$event","$obj",`with($obj) {  ${o}}`).apply(e,[t,C(e)])}const h={getComponentsFromText:v,LOG:g,tagSplit:b,runFunction:y,getMethods:w};class T{constructor(){l(this,"listeners",{});l(this,"removeListeners",[]);l(this,"state",{});l(this,"props",{});return this.state=this.state??{},this.props=this.props??{},new Proxy(this,{ownKeys(t){return Object.keys(t.state).concat(Object.keys(t.props)).concat(Object.keys(t)).concat(h.getMethods(t)).filter((e,n,s)=>s.indexOf(e)===n).filter(e=>!["elApp","state","props","listeners","removeListeners","number"].includes(e))},set:(t,e,n)=>{if(e in t.state){const s=t.state[e];return t.state[e]=n,setTimeout(()=>{t.applyProperty(e,n,s)},1),!0}if(e in t.props){const s=t.props[e];return t.props[e]=n,setTimeout(()=>{t.applyProperty(e,n,s)},1),!0}return t[e]=n,!0},get:(t,e)=>e in t.state?t.state[e]:e in t.props?t.props[e]:t[e]})}cleanup(t){this.removeListeners.push(t)}watch(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}applyProperty(t,e,n){this.listeners[t]&&this.listeners[t].forEach(s=>s(e,n))}applyCleanup(){this.removeListeners.forEach(t=>t()),this.removeListeners=[],this.listeners={}}onChange(t,e){this.watch(t,e)}}class p{constructor(t){l(this,"selector","*");this.component=t}run(){let t=this.selector;t!="*"&&(t="["+this.selector+"]"),[...this.component.el.querySelectorAll(t)].filter(this.filter.bind(this)).forEach(this.applyItem.bind(this))}filter(t){return!0}applyItem(t){}}class L extends p{constructor(){super(...arguments);l(this,"selector","so-html")}applyItem(e){let n=e.getAttribute(this.selector);n&&(this.component.watch(n,()=>{e.innerHTML=this.component[n]}),e.innerHTML=this.component[n])}}class A extends p{constructor(){super(...arguments);l(this,"selector","so-model")}applyItem(e){let n=e.getAttribute(this.selector);n&&(this.component.watch(n,()=>{e.value=this.component[n]}),e.value=this.component[n],e.addEventListener("input",s=>{this.component[n]=s.target.value}),this.component.cleanup(()=>{e.removeEventListener("input",s=>{this.component[n]=s.target.value})}))}}class E extends p{constructor(){super(...arguments);l(this,"selector","so-text")}applyItem(e){let n=e.getAttribute(this.selector);n&&(this.component.watch(n,()=>{e.innerText=this.component[n]}),e.innerText=this.component[n])}}class x extends p{constructor(t){super(t)}filter(t){return Array.from(t.attributes).some(e=>e.name.startsWith("so-on:"))}applyItem(t){Array.from(t.attributes).forEach(e=>{if(e.name.startsWith("so-on:")){let n=e.name.replace("so-on:",""),s=e.value;t.addEventListener(n,r=>{h.runFunction(s,r,this.component)}),this.component.cleanup(()=>{t.removeEventListener(n,r=>{h.runFunction(s,r,this.component)})})}})}}class ${constructor(){l(this,"chain",[E,L,A,x])}run(t){this.chain.forEach(e=>{new e(t).run()})}}const O=new $;class a extends T{constructor(){super(...arguments);l(this,"number",new Date().getTime());l(this,"manager");l(this,"parent");l(this,"children",[]);l(this,"elApp",null);l(this,"el");l(this,"$id")}nextId(){return++this.number}getId(){return this.$id||(this.$id=this.nextId()),this.$id}applyComponent(e){let n=document.createElement("template");e=e.trim();let r=h.getComponentsFromText(e).map(i=>(e=e.split(i.component).join(h.tagSplit),this.manager.getComponentByName(i.tag,i.attrs,this)));if(r.length){let i="";e.split(h.tagSplit).forEach((c,u)=>{i+=c,r[u]&&(i+='<span id="sokeio-component-'+r[u].getId()+'">'+r[u].getId()+"</span>")}),e=i,this.children=r}return n.innerHTML=e,n.content.firstChild}onEvent(e,n,s=null){let r=[this.el];s&&(r=[...this.el.querySelectorAll(s)]),!(!r||!r.length)&&r.forEach(i=>{i&&(i.addEventListener(e,n),this.cleanup(()=>{i.removeEventListener(e,n)}))})}renderComponent(){let e=this.render();if(this.el||(this.el=document.createElement("div")),e&&(this.el.innerHTML=e),this.el.children.length){if(e&&this.el.parentNode){let s=this.el.children[0];this.el.parentNode.insertBefore(s,this.el),this.el.remove(),this.el=s}let n=this.applyComponent(this.el.innerHTML);n&&(this.el=n),this.el.setAttribute("data-sokeio-id",this.getId()),this.el.__sokeio=this,O.run(this),this.children.forEach(s=>{if(!s)return;s.parent=this,s.renderComponent();let r=this.el.querySelector("#sokeio-component-"+s.getId());r&&(r.parentNode.insertBefore(s.el,r),r.remove())})}else this.el.innerHTML||(this.el.innerHTML="[NOT ONE COMPONENT]");this.elApp&&this.elApp.appendChild(this.el)}render(){return""}boot(){}ready(){}applyCleanup(){this.children.forEach(e=>{e&&e.applyCleanup()}),this.children=[],super.applyCleanup(),this.el.parentNode.removeChild(this.el),this.el=null,this.parent=null,this.$id=null,this.children=null}}class k extends a{render(){return`
        <div>
            <h1>hello world</h1>
            [sokeio::demo2 /]
        </div>
        `}}class F extends a{constructor(){super(...arguments);l(this,"state",{tesst:"<h1>hello world</h1>test"})}render(){return`
        <div>
            <h1>hello world</h1>
            <div so-text="tesst">dfdfdfdf</div>
            <div so-html="tesst">dfdfdfdf</div>
            <input so-model="tesst" />
            <select so-model="tesst">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            </select>
            <textarea so-model="tesst" ></textarea>
            <button so-on:click="tesst=new Date().getTime();">click</button>
            <button so-on:click="this.tesst=new Date().getTime();">click2</button>
        </div>
        `}}class d extends a{constructor(){super(...arguments);l(this,"components",{"sokeio::demo":k,"sokeio::demo2":F});l(this,"template",null)}registerComponent(e,n){this.components[e]=n}getComponentByName(e,n){if(!e||!this.components[e])return console.warn({name:e,$attrs:n}),null;let s=new this.components[e];return s.manager=this,s.boot&&s.boot(),s}render(){return this.template?this.template:"<div>Tesst [sokeio::demo /] </div>"}run(e=null,n=null){e||(e=document.body),typeof e=="string"&&(e=document.querySelector(e)),this.manager=this,this.el=null,this.template=n,this.elApp=e,this.renderComponent()}}window.sokeio={Application:d,Component:a};window.sokeioApp=new d;
