var u=Object.defineProperty;var f=(s,t,e)=>t in s?u(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(f(s,typeof t!="symbol"?t+"":t,e),e);class b{constructor(){i(this,"listeners",{});i(this,"state",{});i(this,"props",{});return this.state=this.state??{},this.props=this.props??{},new Proxy(this,{ownKeys(t){return Object.keys(t.state).concat(Object.keys(t.props))},set:(t,e,n)=>{if(e in t.state){const o=t.state[e];return t.state[e]=n,setTimeout(()=>{t.applyProperty(e,n,o)},1),!0}if(e in t.props){const o=t.props[e];return t.props[e]=n,setTimeout(()=>{t.applyProperty(e,n,o)},1),!0}return t[e]=n,!0},get:(t,e)=>e in t.state?t.state[e]:e in t.props?t.props[e]:t[e]})}watch(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}applyProperty(t,e,n){this.listeners[t]&&this.listeners[t].forEach(o=>o(e,n))}onChange(t,e){this.watch(t,e)}}function v(s){const t=/\[([\w-:]+)((?:\s+\w+\s*=\s*"[^"]*")*)(\](.*?)\[\/\1\]|\s*\/\])/gs;return[...s.matchAll(t)].map(e=>{const[n,o,r,,l]=e;return{component:n,tag:o,attrs:r,content:l}})}const w="############$$$$$$$$############";function g(...s){console.log(...s)}function T(s){let t={};return Object.keys(s.state).forEach(e=>{Object.defineProperty(t,e,{get(){return s[e]},set(n){s[e]=n},enumerable:!0,configurable:!0})}),t}function x(s,t,e){return new Function("$event","$obj",`with($obj) {  ${s}}`).apply(e,[t,T(e)])}const a={getComponentsFromText:v,LOG:g,tagSplit:w,runFunction:x};class c{constructor(t){i(this,"selector","*");this.component=t}run(){let t=this.selector;t!="*"&&(t="["+this.selector+"]"),[...this.component.el.querySelectorAll(t)].filter(this.filter.bind(this)).forEach(this.applyItem.bind(this))}filter(t){return!0}applyItem(t){}}class C extends c{constructor(){super(...arguments);i(this,"selector","so-html")}applyItem(e){let n=e.getAttribute(this.selector);n&&(this.component.watch(n,()=>{e.innerHTML=this.component[n]}),e.innerHTML=this.component[n])}}class $ extends c{constructor(){super(...arguments);i(this,"selector","so-model")}applyItem(e){let n=e.getAttribute(this.selector);n&&(this.component.watch(n,()=>{e.value=this.component[n]}),e.value=this.component[n],e.addEventListener("input",o=>{this.component[n]=o.target.value}))}}class k extends c{constructor(){super(...arguments);i(this,"selector","so-text")}applyItem(e){let n=e.getAttribute(this.selector);n&&(this.component.watch(n,()=>{e.innerText=this.component[n]}),e.innerText=this.component[n])}}class I extends c{constructor(t){super(t)}filter(t){return Array.from(t.attributes).some(e=>e.name.startsWith("so-on:"))}applyItem(t){Array.from(t.attributes).forEach(e=>{if(e.name.startsWith("so-on:")){let n=e.name.replace("so-on:",""),o=e.value;t.addEventListener(n,r=>{a.runFunction(o,r,this.component)})}})}}class A{constructor(){i(this,"chain",[k,C,$,I])}run(t){this.chain.forEach(e=>{new e(t).run()})}}const M=new A;class h extends b{constructor(){super(...arguments);i(this,"number",new Date().getTime());i(this,"manager");i(this,"parent");i(this,"children",[]);i(this,"el");i(this,"$id")}nextId(){return++this.number}getId(){return this.$id||(this.$id=this.nextId()),this.$id}applyComponent(e){let n=document.createElement("template");e=e.trim();let r=a.getComponentsFromText(e).map(l=>(e=e.split(l.component).join(a.tagSplit),this.manager.getComponentByName(l.tag,l.attrs,this)));if(r.length){let l="";e.split(a.tagSplit).forEach((m,p)=>{l+=m,r[p]&&(l+='<span id="sokeio-component-'+r[p].getId()+'">'+r[p].getId()+"</span>")}),e=l,this.children=r}return n.innerHTML=e,n.content.firstChild}renderComponent(){let e=this.render();if(this.el||(this.el=document.createElement("div")),e&&(this.el.innerHTML=e),this.el.children.length){if(e&&this.el.parentNode){let o=this.el.children[0];this.el.parentNode.insertBefore(o,this.el),this.el.remove(),this.el=o}let n=this.applyComponent(this.el.innerHTML);n&&(this.el=n),this.el.setAttribute("data-sokeio-id",this.getId()),this.el.__sokeio=this,M.run(this),this.children.forEach(o=>{if(!o)return;o.parent=this,o.renderComponent();let r=this.el.querySelector("#sokeio-component-"+o.getId());r&&(r.parentNode.insertBefore(o.el,r),r.remove())})}else this.el.innerHTML||(this.el.innerHTML="[NOT ONE COMPONENT]")}render(){return""}boot(){}ready(){}}class y extends h{render(){return`
        <div>
            <h1>hello world</h1>
            [sokeio::demo2 /]
        </div>
        `}}class L extends h{constructor(){super(...arguments);i(this,"state",{tesst:"<h1>hello world</h1>test"})}render(){return`
        <div>
            <h1>hello world</h1>
            <div so-text="tesst">dfdfdfdf</div>
            <div so-html="tesst">dfdfdfdf</div>
            <input so-model="tesst" />
            <select so-model="tesst">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            </select>
            <textarea so-model="tesst" ></textarea>
            <button so-on:click="tesst=new Date().getTime();">click</button>
            <button so-on:click="this.tesst=new Date().getTime();">click2</button>
        </div>
        `}}class d extends h{constructor(){super(...arguments);i(this,"components",{"sokeio::demo":y,"sokeio::demo2":L})}registerComponent(e,n){this.components[e]=n}getComponentByName(e,n){if(!e||!this.components[e])return console.warn({name:e,$attrs:n}),null;let o=new this.components[e];return o.manager=this,o.boot&&o.boot(),o}render(){return`
    <div>
    Tesst [sokeio::demo /]
    </div>
    `}run(e=null){e||(e=document.body),typeof e=="string"&&(e=document.querySelector(e)),this.manager=this,this.el=null,this.renderComponent(),e.appendChild(this.el)}}window.sokeio={Application:d,Component:h};window.sokeioApp=new d;
